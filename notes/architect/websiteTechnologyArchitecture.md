---
layout: post
notes: true
subtitle: "大型网站技术架构（核心原理与案例分析）"
comments: false
author: "李智慧"
date: 2016-11-8 12:00:00

---

![](/img/notes/architect/websiteTechnologyArchitecture/website_technology_architecture.jpg)

*   目录
{:toc }

# 第1篇 概述

# 1 大型网站架构演化

## 1.1 大型网站软件系统的特点

*   高并发，大流量
*   高可用：系统7*24小时不间断服务
*   海量数据
*   用户分布广泛，网络情况复杂
*   安全环境恶劣
*   需求快速变更，发布频繁
*   渐进式发展

## 1.2 大型网站架构演化发展历程

### 1.2.1 初始阶段的网站架构

![](/img/notes/architect/websiteTechnologyArchitecture/beginning_stage.png)

应用程序、数据库、文件等所有的资源都在一台服务器上。

缺点：越来越多的用户访问导致性能越来越差，越来越多的数据导致存储空间不足。

### 1.2.2 应用服务和数据服务分离

![](/img/notes/architect/websiteTechnologyArchitecture/application_data_seperate.jpg)

应用和数据分离后整个网站使用三台服务器：应用服务器、文件服务器和数据库服务器：

*   应用服务器需要处理大量的业务逻辑，因此需要更快更强大的CPU；
*   数据库服务器需要快速磁盘检索和数据缓存，因此需要更快的硬盘和更大的内存；
*   文件服务器需要存储大量用户上传的文件，因此需要更大的磁盘。

缺点：数据库压力太大导致访问延迟，今儿影响整个网站的性能，用户体验受到影响。

### 1.2.3 使用缓存改善网站性能

二八定律：80%的业务访问集中在20%的数据上

![](/img/notes/architect/websiteTechnologyArchitecture/cache.png)

网站使用的缓存可以分为两种：缓存在应用服务器上的本地缓存和缓存在专门的分布式缓存服务器上的远程缓存。

优点：数据访问压力得到有效缓解

缺点：在网站访问高峰期，应用服务器成为整个网站的瓶颈。

### 1.2.4 使用应用服务器集群改善网站的并发处理能力

<img src="/img/notes/architect/websiteTechnologyArchitecture/application_server_cluster.jpg" width="500" height="305"/>

通过负载均衡调度服务器，可将来自用户浏览器的访问请求分发到应用服务器集群中的任何一台服务器上，如果有更多的用户，就在集群中加入更多的应用服务器，使应用服务器的负载压力不再成为整个网站的瓶颈。

### 1.2.5 数据库读写分离

问题：网站在使用缓存后，使绝大部分数据读操作访问都可以不通过数据库就能完成，但是仍有一部分读（缓存访问不命中、缓存过期）和全部的写操作需要访问数据库，在网站的用户达到一定规模后，数据库因为负载压力过高而成为网站的瓶颈。

解决方案：数据库读写分离，改善数据库负载压力。为了便于应用程序访问读写分离后的数据库，通常在应用服务器端使用专门的数据访问模块，使数据库读写分离对应用透明。

### 1.2.6 使用反向代理和CDN加速网站响应

![](/img/notes/architect/websiteTechnologyArchitecture/cdn_reverse_proxy.png)

CDN和反向代理的基本原理都是缓存，区别在于：

*   CDN部署在网络提供商的机房，使用户在请求网站服务时，可以从距离自己最近的网络提供商机房获取数据；
*   反向代理则部署在网站的中心机房，当用户请求到达中心机房后，首先访问的服务器是反向代理服务器，如果反向代理服务器中缓存着用户请求的资源，就将其直接返回给用户。

使用CDN和反向代理的目的都是尽早返回数据给用户，一方面加快用户访问速度，另一方面也减轻后端服务器的负载压力。

### 1.2.7 使用分布式文件系统和分布式数据库系统

任何强大的单一服务器都满足不了大型网站持续增长的业务需求。

分布式数据库是网站数据库拆分的最后手段，只有在单表数据规模非常庞大的时候才使用。不到不得已时，网站更常用的数据库拆分手段是业务分库，将不同业务的数据库部署在不同的物理服务器上。

![](/img/notes/architect/websiteTechnologyArchitecture/distributed.png)